"use strict";

var errors = module.exports = {};

errors.UNKNOWN = { errno: -1, code: "UNKNOWN", description: "unknown error" },
errors.OK = { errno: 0, code: "OK", description: "success" },
errors.EOF = { errno: 1, code: "EOF", description: "end of file" },
errors.EADDRINFO = { errno: 2, code: "EADDRINFO", description: "getaddrinfo error" },
errors.EACCES = { errno: 3, code: "EACCES", description: "permission denied" },
errors.EAGAIN = { errno: 4, code: "EAGAIN", description: "no more processes" },
errors.EADDRINUSE = { errno: 5, code: "EADDRINUSE", description: "address already in use" },
errors.EADDRNOTAVAIL = { errno: 6, code: "EADDRNOTAVAIL", description: "" },
errors.EAFNOSUPPORT = { errno: 7, code: "EAFNOSUPPORT", description: "" },
errors.EALREADY = { errno: 8, code: "EALREADY", description: "" },
errors.EBADF = { errno: 9, code: "EBADF", description: "bad file descriptor" },
errors.EBUSY = { errno: 10, code: "EBUSY", description: "resource busy or locked" },
errors.ECONNABORTED = { errno: 11, code: "ECONNABORTED", description: "software caused connection abort" },
errors.ECONNREFUSED = { errno: 12, code: "ECONNREFUSED", description: "connection refused" },
errors.ECONNRESET = { errno: 13, code: "ECONNRESET", description: "connection reset by peer" },
errors.EDESTADDRREQ = { errno: 14, code: "EDESTADDRREQ", description: "destination address required" },
errors.EFAULT = { errno: 15, code: "EFAULT", description: "bad address in system call argument" },
errors.EHOSTUNREACH = { errno: 16, code: "EHOSTUNREACH", description: "host is unreachable" },
errors.EINTR = { errno: 17, code: "EINTR", description: "interrupted system call" },
errors.EINVAL = { errno: 18, code: "EINVAL", description: "invalid argument" },
errors.EISCONN = { errno: 19, code: "EISCONN", description: "socket is already connected" },
errors.EMFILE = { errno: 20, code: "EMFILE", description: "too many open files" },
errors.EMSGSIZE = { errno: 21, code: "EMSGSIZE", description: "message too long" },
errors.ENETDOWN = { errno: 22, code: "ENETDOWN", description: "network is down" },
errors.ENETUNREACH = { errno: 23, code: "ENETUNREACH", description: "network is unreachable" },
errors.ENFILE = { errno: 24, code: "ENFILE", description: "file table overflow" },
errors.ENOBUFS = { errno: 25, code: "ENOBUFS", description: "no buffer space available" },
errors.ENOMEM = { errno: 26, code: "ENOMEM", description: "not enough memory" },
errors.ENOTDIR = { errno: 27, code: "ENOTDIR", description: "not a directory" },
errors.EISDIR = { errno: 28, code: "EISDIR", description: "illegal operation on a directory" },
errors.ENONET = { errno: 29, code: "ENONET", description: "machine is not on the network" },
errors.ENOTCONN = { errno: 31, code: "ENOTCONN", description: "socket is not connected" },
errors.ENOTSOCK = { errno: 32, code: "ENOTSOCK", description: "socket operation on non-socket" },
errors.ENOTSUP = { errno: 33, code: "ENOTSUP", description: "operation not supported on socket" },
errors.ENOENT = { errno: 34, code: "ENOENT", description: "no such file or directory" },
errors.ENOSYS = { errno: 35, code: "ENOSYS", description: "function not implemented" },
errors.EPIPE = { errno: 36, code: "EPIPE", description: "broken pipe" },
errors.EPROTO = { errno: 37, code: "EPROTO", description: "protocol error" },
errors.EPROTONOSUPPORT = { errno: 38, code: "EPROTONOSUPPORT", description: "protocol not supported" },
errors.EPROTOTYPE = { errno: 39, code: "EPROTOTYPE", description: "protocol wrong type for socket" },
errors.ETIMEDOUT = { errno: 40, code: "ETIMEDOUT", description: "connection timed out" },
errors.ECHARSET = { errno: 41, code: "ECHARSET", description: "" },
errors.EAIFAMNOSUPPORT = { errno: 42, code: "EAIFAMNOSUPPORT", description: "" },
errors.EAISERVICE = { errno: 44, code: "EAISERVICE", description: "" },
errors.EAISOCKTYPE = { errno: 45, code: "EAISOCKTYPE", description: "" },
errors.ESHUTDOWN = { errno: 46, code: "ESHUTDOWN", description: "" },
errors.EEXIST = { errno: 47, code: "EEXIST", description: "file already exists" },
errors.ESRCH = { errno: 48, code: "ESRCH", description: "no such process" },
errors.ENAMETOOLONG = { errno: 49, code: "ENAMETOOLONG", description: "name too long" },
errors.EPERM = { errno: 50, code: "EPERM", description: "operation not permitted" },
errors.ELOOP = { errno: 51, code: "ELOOP", description: "too many symbolic links encountered" },
errors.EXDEV = { errno: 52, code: "EXDEV", description: "cross-device link not permitted" },
errors.ENOTEMPTY = { errno: 53, code: "ENOTEMPTY", description: "directory not empty" },
errors.ENOSPC = { errno: 54, code: "ENOSPC", description: "no space left on device" },
errors.EIO = { errno: 55, code: "EIO", description: "i/o error" },
errors.EROFS = { errno: 56, code: "EROFS", description: "read-only file system" },
errors.ENODEV = { errno: 57, code: "ENODEV", description: "no such device" },
errors.ESPIPE = { errno: 58, code: "ESPIPE", description: "invalid seek" },
errors.ECANCELED = { errno: 59, code: "ECANCELED", description: "operation canceled" }

var codes = {
	"-1": "UNKNOWN",
	"0": "OK",
	"1": "EOF",
	"2": "EADDRINFO",
	"3": "EACCES",
	"4": "EAGAIN",
	"5": "EADDRINUSE",
	"6": "EADDRNOTAVAIL",
	"7": "EAFNOSUPPORT",
	"8": "EALREADY",
	"9": "EBADF",
	"10": "EBUSY",
	"11": "ECONNABORTED",
	"12": "ECONNREFUSED",
	"13": "ECONNRESET",
	"14": "EDESTADDRREQ",
	"15": "EFAULT",
	"16": "EHOSTUNREACH",
	"17": "EINTR",
	"18": "EINVAL",
	"19": "EISCONN",
	"20": "EMFILE",
	"21": "EMSGSIZE",
	"22": "ENETDOWN",
	"23": "ENETUNREACH",
	"24": "ENFILE",
	"25": "ENOBUFS",
	"26": "ENOMEM",
	"27": "ENOTDIR",
	"28": "EISDIR",
	"29": "ENONET",
	"31": "ENOTCONN",
	"32": "ENOTSOCK",
	"33": "ENOTSUP",
	"34": "ENOENT",
	"35": "ENOSYS",
	"36": "EPIPE",
	"37": "EPROTO",
	"38": "EPROTONOSUPPORT",
	"39": "EPROTOTYPE",
	"40": "ETIMEDOUT",
	"41": "ECHARSET",
	"42": "EAIFAMNOSUPPORT",
	"44": "EAISERVICE",
	"45": "EAISOCKTYPE",
	"46": "ESHUTDOWN",
	"47": "EEXIST",
	"48": "ESRCH",
	"49": "ENAMETOOLONG",
	"50": "EPERM",
	"51": "ELOOP",
	"52": "EXDEV",
	"53": "ENOTEMPTY",
	"54": "ENOSPC",
	"55": "EIO",
	"56": "EROFS",
	"57": "ENODEV",
	"58": "ESPIPE",
	"59": "ECANCELED"
};

errors.create = function (errno, code, description, props){
	var e = {
		errno: errno,
		code: code,
		description: description
	};
	
	if (props){
		for (var p in props){
			e[p] = props[p];
		}
	}
	
	errors[code] = e;
	codes[errno] = code;
};

var replace = function (s, k, v){
	return s.replace (new RegExp ("\\{" + k + "\\}", "g"), v);
};

errors.get = function (id, vars){
	var error;
	var type = typeof id;
	
	if (type === "number"){
		error = errors[codes[id]];
	}else if (type === "string"){
		error = errors[id];
	}else{
		error = id;
	}
	
	if (!error){
		error = new Error ("ERROR_NOT_FOUND");
		error.description = "Error not found";
		error.id = id;
		throw error;
	}
	
	var e = new Error (error.code);
	
	for (var p in error){
		e[p] = error[p];
	}
	
	if (vars){
		for (var p in e){
			if (typeof e[p] !== "string") continue;
			for (var v in vars){
				e[p] = e[p].replace (new RegExp ("\\{" + v + "\\}", "g"),
						vars[v]);
			}
		}
	}
	
	return e;
};

var next = 100;

errors.next = function (){
	var n = next;
	next++;
	return n;
};